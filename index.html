<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport"/>
  <meta name="theme-color" content="#ff8a3d"/>
  <meta name="description" content="Jiasa - 用滑的找餐廳"/>
  <link rel="manifest" href="manifest.json"/>
  <link rel="apple-touch-icon" href="assets/icon-192.png"/>
  <title>Jiasa</title>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBUqTZXhK9NfLmpCl04abAcxZej7LDdyGI&libraries=places&language=zh-TW&v=beta"></script>

  <link rel="stylesheet" href="style.css">

</head>
<body>
  <div class="splash-screen" id="splashScreen">
    <div class="splash-logo-container">
      <div class="splash-icon-wrapper">
        <img src="assets/bowl.png" class="splash-bowl" alt="碗">
        <img src="assets/arrow.png" class="splash-arrow" alt="箭頭">
      </div>
      <img src="assets/jiasa-text.png" class="splash-wordmark" alt="Jiasa">
    </div>
  </div>

  <div class="offline-badge" id="offlineBadge">離線模式</div>
  <div class="phone">
    <header>
      <h1><img src="assets/Jiasa_headerlogowordmark.png" alt="Jiasa"/></h1>
    </header>
    <main id="swipe">
      <div class="stack" id="stack"></div>
      <div class="controls">
        <button aria-label="Undo" class="btn" id="btnUndo">↩︎ 撤回</button>
        <button class="btn secondary" id="btnSkip">略過</button>
        <button class="btn primary" id="btnChoose">選這家</button>
      </div>
      <div class="hint" id="hintKeys">提示：可以左右滑動卡片，或用 ← → 鍵操作。</div>
    </main>
    <section id="result" style="display:none;">
      <div class="card" id="resultCard">
        <img alt="photo" class="hero" id="hero" style="display:none;"/>
        <div id="resultBody"></div>
  
        <div class="divider"></div>
        <div class="kv" id="gEnrich"></div>
        <div class="hours-badge" id="hoursBadge"></div>
        <button class="btn" id="toggleHours" style="margin-top:8px; display:none;">顯示營業時間</button>
        <div class="hours-box" id="hoursBox"></div>
      </div>
      <div class="result-controls">
        <button class="btn" id="btnBack">
          <svg class="btn-icon" viewBox="0 0 24 24"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
          <span id="btnBackText">返回</span>
        </button>
        <button class="btn primary" id="btnFav">
          <svg class="btn-icon" viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
          <span id="btnFavText">收藏</span>
        </button>
      </div>
      <div class="result-actions">
        <button class="btn" id="btnMap">
          <svg class="btn-icon" viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
          <span id="btnMapText">開地圖</span>
        </button>
        <a class="btn" id="btnWebsite" rel="noopener" style="display:none;" target="_blank">
          <svg class="btn-icon" viewBox="0 0 24 24"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>
          <span id="btnWebText">官網</span>
        </a>
      </div>
    </section>

    <nav class="bottom-nav">
      <button class="nav-item active" id="navHome">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
          <path d="M9 22V12h6v10"/>
        </svg>
        <span class="nav-label">首頁</span>
      </button>
      <button class="nav-item" id="navFavs">
         <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
        </svg>
        <span class="nav-label">收藏</span>
      </button>
      <button class="nav-item" id="navRefresh">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
           <path d="M23 4v6h-6M1 20v-6h6"/>
          <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
        </svg>
        <span class="nav-label">刷新</span>
      </button>
      <button class="nav-item" id="navHistory">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="9"/>
          <path d="M12 7v5l3 2"/>
        </svg>
        <span class="nav-label">歷史</span>
      </button>
      <button class="nav-item" id="navSettings">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19.14 12.94c.04-.31.06-.63.06-.94s-.02-.63-.06-.94l2.03-1.58a.5.5 0 0 0 .12-.64l-1.92-3.32a.5.5 0 0 0-.6-.22l-2.39.96a7.2 7.2 0 0 0-1.63-.94l-.36-2.54a.5.5 0 0 0-.5-.42h-3.84a.5.5 0 0 0-.5.42l-.36 2.54c-.58.24-1.12.55-1.63.94l-2.39-.96a.5.5 0 0 0-.6.22L2.65 8.84a.5.5 0 0 0 .12.64l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94L2.77 14.52a.5.5 0 0 0-.12.64l1.92 3.32a.5.5 0 0 0 .6.22l2.39-.96c.51.39 1.05.7 1.63.94l.36 2.54c.05.24.26.42.5.42h3.84c.24 0 .45-.18.5-.42l.36-2.54c.58-.24 1.12-.55-1.63.94l2.39.96a.5.5 0 0 0 .6-.22l1.92-3.32a.5.5 0 0 0-.12-.64l-2.03-1.58z"/>
          <circle cx="12" cy="12" r="3.2"/>
        </svg>
        <span class="nav-label">設定</span>
      </button>
    </nav>
  </div>

  <div class="overlay" id="overlay"></div>
  <div aria-modal="true" class="modal" id="modal" role="dialog">
    <div class="modal-header">
      <div class="label" id="mTitle">設定</div>
       <button aria-label="Close" class="iconbtn" id="btnClose">
        <svg viewbox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"></path></svg>
      </button>
    </div>
    <div class="modal-body">
      <div class="section" id="filtersBlock">
        <div class="filter-actions">
          <div class="label" style="margin:0;">篩選條件</div>
          <button class="clear-filters" id="btnClearFilters">清除全部</button>
        </div>
        <div>
           <div class="field-group" id="grpRating">
            <div class="label" id="lblMinRating">最低評分</div>
            <div class="rating-display"><span>⭐</span><span class="rating-value" id="ratingShow">3.0+</span></div>
            <input id="minRating" type="range" min="0" max="5" step="0.5" value="3"/>
            <div class="hint" id="hintRating" style="display:none;">只顯示評分高於此值的餐廳。</div>
          </div>
          <div class="field-group" id="grpPrice">
           <div class="label" id="lblPrice">價格範圍</div>
            <div class="row" id="priceRow"></div>
            <div class="hint" id="hintPrice" style="display:none;">可選擇價格範圍</div>
          </div>
          <div class="field-group" id="grpDistance">
            <div class="label" id="lblDistance">搜尋距離(公尺)</div>
            <div class="row"><span class="pill" id="distanceShow">≤ 1500m</span></div>
            <input id="distance" type="range" min="500" max="5000" step="250" value="1500"/>
            <div class="hint" id="hintDistance" style="display:none;">需允許定位權限。</div>
          </div>
        </div>
      </div>
      <div class="section">
        <div class="label" id="lblTypes">餐廳類型</div>
        <div class="row" id="typesRow"></div>
        <div class="hint" id="hintTypes" style="display:none;">可選擇多個類型，未選表示全部。</div>
      </div>
      <div class="section">
        <div class="label" id="lblCuisine">料理風格(關鍵字)</div>
        <div class="row" id="cuisineRow"></div>
        <div class="hint" id="hintCuisine" style="display:none;">作為搜尋關鍵字使用。</div>
      </div>
      <div class="section">
        <div class="label" id="lblLang">語言</div>
        <select class="select" id="langSelModal">
          <option value="zh">繁體中文</option>
          <option value="en">English</option>
        </select>
      </div>
      <div class="section">
         <div class="label" id="lblTheme">主題</div>
        <select class="select" id="themeSelect">
          <option data-zh="經典" value="classic">Classic</option>
          <option data-zh="摩卡" value="mocha">Mocha</option>
          <option data-zh="橄欖" value="olive">Olive</option>
          <option data-zh="櫻花" value="sakura">Sakura</option>
        </select>
      </div>
      <div style="display:flex; gap:10px; margin-top:12px; justify-content:flex-end;">
        <button class="btn primary" id="applySettings" style="width:auto;"><span id="applyText">套用</span></button>
      </div>
    </div>
  </div>

  <div class="overlay" id="favOverlay"></div>
  <div aria-modal="true" class="modal" id="favModal" role="dialog">
    <div class="modal-header">
      <div class="label" id="favTitle">收藏清單</div>
      <button aria-label="Close" class="iconbtn" id="favClose">
        <svg viewbox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"></path></svg>
      </button>
    </div>
    <div class="modal-body">
      <div id="favList"></div>
     </div>
  </div>

  <div class="overlay" id="histOverlay"></div>
  <div aria-modal="true" class="modal" id="histModal" role="dialog">
    <div class="modal-header">
      <div class="label" id="histTitle">歷史紀錄</div>
      <button aria-label="Close" class="iconbtn" id="histClose">
        <svg viewbox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"></path></svg>
      </button>
    </div>
    <div class="modal-body">
      <div id="histList"></div>
    </div>
  </div>

  <script type="module" src="app.js"></script>
</body>
</html>